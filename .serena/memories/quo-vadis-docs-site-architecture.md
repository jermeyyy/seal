# Quo-Vadis Documentation Site Architecture

## Tech Stack
- **React 19** + **TypeScript** + **Vite 7**
- **React Router DOM** for client-side routing
- **highlight.js** for code syntax highlighting
- **flexsearch** for client-side search
- **CSS Modules** for component-scoped styles

## Package.json
```json
{
  "name": "quo-vadis-page",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "npm run build:search && tsc -b && vite build",
    "build:search": "node scripts/buildSearchIndex.js",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "react": "^19.1.1",
    "react-dom": "^19.1.1"
  },
  "devDependencies": {
    "@eslint/js": "^9.36.0",
    "@types/flexsearch": "^0.7.6",
    "@types/node": "^24.6.0",
    "@types/react": "^19.1.16",
    "@types/react-dom": "^19.1.9",
    "@vitejs/plugin-react": "^5.0.4",
    "eslint": "^9.36.0",
    "eslint-plugin-react-hooks": "^5.2.0",
    "eslint-plugin-react-refresh": "^0.4.22",
    "flexsearch": "^0.8.212",
    "globals": "^16.4.0",
    "highlight.js": "^11.11.1",
    "react-router-dom": "^7.9.4",
    "typescript": "~5.9.3",
    "typescript-eslint": "^8.45.0",
    "vite": "^7.1.7"
  }
}
```

## Vite Config
```ts
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import path from 'path'

export default defineConfig(({ mode }) => ({
  plugins: [react()],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
      '@components': path.resolve(__dirname, './src/components'),
      '@pages': path.resolve(__dirname, './src/pages'),
      '@utils': path.resolve(__dirname, './src/utils'),
      '@hooks': path.resolve(__dirname, './src/hooks'),
      '@styles': path.resolve(__dirname, './src/styles'),
      '@data': path.resolve(__dirname, './src/data'),
    }
  },
  base: mode === 'production' ? '/quo-vadis/' : '/',  // Change to /seal/ for seal
  build: {
    outDir: 'dist',
    assetsDir: 'assets',
    rollupOptions: {
      output: {
        manualChunks: {
          'react-vendor': ['react', 'react-dom', 'react-router-dom'],
          'highlight': ['highlight.js'],
          'search': ['flexsearch']
        }
      }
    }
  }
}))
```

## Directory Structure
```
docs/site/
├── package.json
├── vite.config.ts
├── tsconfig.json / tsconfig.app.json / tsconfig.node.json
├── eslint.config.js
├── index.html (SPA redirect script for GitHub Pages)
├── public/
│   ├── 404.html (SPA redirect for GitHub Pages)
│   ├── favicon.ico, favicon-16x16.png, favicon-32x32.png
│   ├── apple-touch-icon.png
│   ├── logo.jpg
│   └── images/ (screenshots)
├── scripts/
│   └── buildSearchIndex.js (extracts content from .tsx pages for search)
└── src/
    ├── App.tsx (BrowserRouter, Routes, Layout wrapper)
    ├── App.css
    ├── main.tsx (entry point, renders App)
    ├── index.css
    ├── styles/
    │   ├── global.css (base styles, imports variables.css)
    │   └── variables.css (CSS custom properties, light/dark themes)
    ├── components/
    │   ├── CodeBlock/ (CodeBlock.tsx, CodeBlock.module.css, codeblock-theme.css)
    │   ├── Layout/ (Layout.tsx, Navbar.tsx, Sidebar.tsx, TableOfContents.tsx + .module.css)
    │   ├── MobileMenu/ (MobileMenu.tsx + .module.css)
    │   ├── Search/ (SearchBar.tsx, SearchModal.tsx + .module.css)
    │   ├── ThemeToggle/ (ThemeToggle.tsx + .module.css)
    │   ├── NavNodeTypesTable/ (domain-specific, won't reuse)
    │   ├── PlatformSupportGrid/ (domain-specific, won't reuse)
    │   ├── ScopePropertiesTable/ (domain-specific, won't reuse)
    │   └── TransitionTypesDisplay/ (domain-specific, won't reuse)
    ├── contexts/
    │   ├── SearchContext.tsx (search provider with flexsearch)
    │   └── ThemeContext.tsx (dark/light theme toggle)
    ├── data/
    │   ├── codeExamples.ts (centralized code snippets)
    │   ├── constants.ts (version, maven artifacts, URLs)
    │   ├── navigation.ts (sidebar nav structure with NavItem type)
    │   └── searchData.json (generated by buildSearchIndex.js)
    └── pages/
        ├── Home/ (Home.tsx, Home.module.css)
        ├── GettingStarted/ (GettingStarted.tsx, GettingStarted.module.css)
        ├── Demo/ (Demo.tsx, Demo.module.css)
        └── Features/
            ├── Features.module.css (shared feature page styles)
            ├── AnnotationAPI/
            ├── CoreConcepts/
            ├── DIIntegration/ (with CoreConcepts/ and Usage/ subpages)
            ├── DSLConfig/
            ├── DeepLinks/
            ├── Modular/
            ├── Multiplatform/
            ├── PaneLayouts/
            ├── PredictiveBack/
            ├── TabbedNavigation/
            ├── Testing/
            ├── Transitions/
            └── TypeSafe/
```

## Key Reusable Components (Copy to Seal)
1. **Layout/** - Navbar, Sidebar, TableOfContents, Layout wrapper
2. **CodeBlock/** - Syntax highlighting with highlight.js
3. **ThemeToggle/** - Dark/light mode toggle
4. **Search/** - SearchBar + SearchModal with flexsearch
5. **MobileMenu/** - Mobile hamburger menu
6. **contexts/** - ThemeContext, SearchContext

## CSS Design System (variables.css)
- Layout: `--navbar-height: 64px`, `--sidebar-width: 280px`, `--toc-width: 240px`
- Colors: `--primary-color: #2196F3`, `--primary-dark: #1976D2`
- Dark theme via `[data-theme="dark"]` selector
- Typography: system fonts, monospace for code
- Spacing: xs(0.25rem) through xl(3rem)
- Shadows, transitions, border-radius tokens

## GitHub Actions Deploy Workflow (deploy-pages.yml)
```yaml
name: Deploy GitHub Pages
on:
  push:
    branches: [ main ]
  workflow_dispatch:

permissions:
  contents: read
  pages: write
  id-token: write

concurrency:
  group: "pages"
  cancel-in-progress: true

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          cache-dependency-path: docs/site/package-lock.json
      - uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'
      - uses: gradle/gradle-build-action@v3
      - name: Install npm dependencies
        working-directory: docs/site
        run: npm ci
      - name: Build React documentation site
        working-directory: docs/site
        run: npm run build
      - name: Generate Dokka multi-module documentation
        run: ./gradlew dokkaGeneratePublicationHtml --no-daemon
      - name: Prepare GitHub Pages content
        run: |
          mkdir -p _site
          cp -r docs/site/dist/* _site/
          cp -r build/dokka/html _site/api
      - uses: actions/upload-pages-artifact@v3
        with:
          path: '_site'
  deploy:
    needs: build
    runs-on: ubuntu-latest
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    steps:
      - uses: actions/deploy-pages@v4
```

## Navigation Data Structure (navigation.ts)
```ts
export interface NavItem {
  label: string
  path?: string
  href?: string
  external?: boolean
  icon?: string
  children?: NavItem[]
}

export const navigationData: NavItem[] = [
  { label: 'Home', path: '/' },
  { label: 'Getting Started', path: '/getting-started' },
  {
    label: 'Features',
    children: [
      { label: 'Core Concepts', path: '/features/core-concepts' },
      { label: 'Annotation-Based API', path: '/features/annotation-api' },
      // ... more items
    ]
  },
  { label: 'Demo', path: '/demo' },
  {
    label: 'API Reference',
    href: '/quo-vadis/api/index.html',
    external: true
  },
  {
    label: 'GitHub',
    href: 'https://github.com/jermeyyy/quo-vadis',
    external: true,
    icon: 'github'
  }
]
```

## App.tsx Pattern
```tsx
function App() {
  const basename = import.meta.env.PROD ? '/quo-vadis' : '/'
  return (
    <ThemeProvider>
      <SearchProvider>
        <BrowserRouter basename={basename}>
          <Layout>
            <Routes>
              <Route path="/" element={<Home />} />
              <Route path="/getting-started" element={<GettingStarted />} />
              // ... feature routes
              <Route path="/demo" element={<Demo />} />
              <Route path="*" element={<Home />} />
            </Routes>
          </Layout>
          <SearchModal />
        </BrowserRouter>
      </SearchProvider>
    </ThemeProvider>
  )
}
```

## Layout.tsx Pattern
```tsx
export default function Layout({ children }: LayoutProps) {
  const [sidebarOpen, setSidebarOpen] = useState(false)
  const [mobileMenuOpen, setMobileMenuOpen] = useState(false)
  return (
    <div className={styles.layout}>
      <Navbar onMenuToggle={() => setMobileMenuOpen(!mobileMenuOpen)} />
      <div className={styles.mainContainer}>
        <Sidebar isOpen={sidebarOpen} onToggle={() => setSidebarOpen(!sidebarOpen)} />
        <main className={styles.content}>{children}</main>
        <TableOfContents />
      </div>
      <MobileMenu isOpen={mobileMenuOpen} onClose={() => setMobileMenuOpen(false)} />
    </div>
  )
}
```

## constants.ts Pattern
```ts
export const LIBRARY_VERSION = '0.3.4';
export const MAVEN_ARTIFACTS = {
  core: 'io.github.jermeyyy:quo-vadis-core',
  // ...
} as const;
export const REPOSITORY_URLS = {
  github: 'https://github.com/jermeyyy/quo-vadis',
  mavenCentral: '...',
  apiDocs: '/quo-vadis/api/index.html',
} as const;
```

## GitHub Pages SPA Handling
- index.html has a script to restore URLs from 404.html redirects
- public/404.html redirects to index.html with path in query string
- This enables React Router paths to work on GitHub Pages

## Dokka Integration
- Multi-module Dokka (dokkaGeneratePublicationHtml)
- Output goes to build/dokka/html/
- Deployed at /api/ path under the site
- API Reference link: `/quo-vadis/api/index.html` (external link from navigation)
